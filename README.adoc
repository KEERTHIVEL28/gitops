= GitOps

You can see an example workflow that uses this repo for GitOps link:https://github.com/r3dact3d/OCP4-Deploy/blob/main/.github/workflows/gitops.yaml[r3dact3d/OCP4-Deploy]

== Purpose

This repo contains everything needed to:

* provision a hub GitOps Instance 
* Day2 cluster config applicationsets
* Onboard remote clusters via cluster generator

== Provision

.Install GitOps Operator
----
oc apply -f https://raw.githubusercontent.com/r3dact3d/gitops/main/gitops-cluster/gitops-operator.yaml -n openshift-operators
oc project openshift-gitops
oc adm policy add-cluster-role-to-user cluster-admin -z openshift-gitops-argocd-application-controller
----

.Optional for running GitOps service on Infra nodes
----
oc apply -f https://raw.githubusercontent.com/r3dact3d/gitops/main/gitops-cluster/gitopsservice.yaml
----

== Day2

.link:https://github.com/r3dact3d/gitops/tree/main/appsets[Applicationsets] with cluster generator are used to manage the ArgoCD applications
----
for i in $(ls appsets);do oc create -f $i;done
----

link:https://github.com/r3dact3d/gitops/tree/main/common-base[Cluster config] manifests logically grouped

== Onboard

.link:https://github.com/r3dact3d/gitops/tree/main/cluster-onboarding[Onboard] new cluster by adding secret to this repo
----
kind: Secret
apiVersion: v1
metadata:
  name: blinker19 
  namespace: openshift-gitops
  labels:
    argocd.argoproj.io/secret-type: cluster
  annotations:
    managed-by: argocd.argoproj.io
data:
  config: base64
  name: base64
  server: base64
type: Opaque
----

